<div class="min-h-screen bg-gray-50 p-6">
  <div class="max-w-7xl mx-auto">
    <!-- 標題與操作區 -->
    <div class="mb-6">
      <div class="flex justify-between items-center mb-4">
        <div>
          <!-- <h1 class="text-3xl font-bold text-gray-900 mb-2">專案進度管理系統</h1> -->
          <p class="text-gray-600">進度報告 - {{ getCurrentDate() }}</p>
        </div>
        <div class="flex gap-2">
          <button mat-raised-button color="warn" (click)="openCreateSystemDialog()" class="flex items-center gap-2">
            <mat-icon>computer</mat-icon>
            新增系統
          </button>
          <button mat-raised-button color="primary" (click)="openCreateProjectDialog()" class="flex items-center gap-2">
            <mat-icon>add</mat-icon>
            新增案件
          </button>
          <button mat-stroked-button color="primary" (click)="openProjectSortDialog()" class="flex items-center gap-2">
            <mat-icon>sort</mat-icon>
            排序管理
          </button>
          <button mat-raised-button color="accent" (click)="openCreateTaskDialog()" class="flex items-center gap-2">
            <mat-icon>assignment_add</mat-icon>
            新增工作項
          </button>
          <button mat-stroked-button color="accent" (click)="openBulkCreateTaskDialog()"
            class="flex items-center gap-2">
            <mat-icon>playlist_add</mat-icon>
            批量新增工作項
          </button>
          <!-- 匯出選單 -->
          <button mat-button [matMenuTriggerFor]="exportMenu" class="flex items-center gap-2">
            匯出 Excel
            <mat-icon>arrow_drop_down</mat-icon>
          </button>
          <mat-menu #exportMenu="matMenu">
            <button mat-menu-item (click)="exportToExcel()">
              <mat-icon>description</mat-icon>
              <span>完整報告</span>
            </button>
            <button mat-menu-item (click)="exportTasksOnly()">
              <mat-icon>assignment</mat-icon>
              <span>工作項清單</span>
            </button>
            <button mat-menu-item (click)="exportProjectSummary()">
              <mat-icon>summarize</mat-icon>
              <span>專案摘要</span>
            </button>
          </mat-menu>
        </div>
      </div>

      <!-- 搜尋與篩選 -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-12 gap-4 mb-4">
        <!-- 1. 搜尋成員選項 -->
        <mat-form-field appearance="outline" class="col-span-2">
          <mat-label>搜尋成員</mat-label>
          <mat-select multiple [value]="selectedMembers" (selectionChange)="onMemberSelectionChange($event.value)"
            placeholder="選擇成員...">
            <mat-option *ngFor="let member of availableMembers" [value]="member">
              {{ member }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- 2. 搜尋專案輸入框 -->
        <mat-form-field appearance="outline" class="col-span-3">
          <mat-label>搜尋專案</mat-label>
          <input matInput [value]="projectSearchTerm" (input)="onProjectSearchChange($any($event.target).value || '')"
            placeholder="輸入專案名稱...">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>



        <!-- 專案狀態複選 -->
        <mat-form-field appearance="outline" class="col-span-2">
          <mat-label>專案狀態</mat-label>
          <mat-select multiple [value]="projectStatusFilters"
            (selectionChange)="onProjectStatusFiltersChange($event.value)" placeholder="選擇專案狀態...">
            <mat-option value="not-started">未開始</mat-option>
            <mat-option value="in-progress">進行中</mat-option>
            <mat-option value="completed">已完成</mat-option>
            <mat-option value="pending">待排</mat-option>
            <mat-option value="on-hold">保留</mat-option>
            <mat-option value="cancelled">廢棄</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- 3. 搜尋工作項輸入框 -->
        <mat-form-field appearance="outline" class="col-span-3">
          <mat-label>搜尋工作項</mat-label>
          <input matInput [value]="taskSearchTerm" (input)="onTaskSearchChange($any($event.target).value || '')"
            placeholder="輸入工作項名稱...">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>

        <!-- 4. 工作項狀態複選 -->
        <mat-form-field appearance="outline" class="col-span-2">
          <mat-label>工作項狀態</mat-label>
          <mat-select multiple [value]="statusFilters" (selectionChange)="onStatusFiltersChange($event.value)"
            placeholder="選擇狀態...">
            <mat-option value="not-started">未開始</mat-option>
            <mat-option value="in-progress">進行中</mat-option>
            <mat-option value="completed">已完成</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

    </div>

    <!-- 導航標籤 -->
    <mat-tab-group [(selectedIndex)]="selectedTabIndex" class="mb-6" (selectedTabChange)="onTabChange($event)">

      <mat-tab label="總覽摘要">
        <div class="pt-6">
          <app-overview-tab [overviewStats$]="overviewStats$" [groupedMemberData$]="groupedMemberData$"
            [groupedProjectData$]="groupedProjectData$">
          </app-overview-tab>
        </div>
      </mat-tab>

      <mat-tab label="人員視角表格">
        <div class="pt-6">
          <app-member-view-tab [groupedMemberData$]="groupedMemberData$" [selectedMembers]="selectedMembers"
            [projectSearchTerm]="projectSearchTerm" [taskSearchTerm]="taskSearchTerm" [statusFilters]="statusFilters"
            [projectStatusFilters]="projectStatusFilters" [hideCompleted]="hideCompleted" [expandedRows]="expandedRows"
            (toggleRow)="toggleRow($event)" (editTask)="openEditTaskDialog($event)"
            (copyTask)="openCopyTaskDialog($event)" (addTask)="openCreateTaskDialog()"
            (deleteTask)="openDeleteTaskDialog($event)">
          </app-member-view-tab>
        </div>
      </mat-tab>

      <mat-tab label="專案視角表格">
        <div class="pt-6">
          <app-project-view-tab [groupedProjectData$]="groupedProjectData$" [selectedMembers]="selectedMembers"
            [projectSearchTerm]="projectSearchTerm" [taskSearchTerm]="taskSearchTerm" [statusFilters]="statusFilters"
            [projectStatusFilters]="projectStatusFilters" [hideCompleted]="hideCompleted" [expandedRows]="expandedRows"
            (toggleRow)="toggleRow($event)" (editProject)="openEditProjectDialog($event)"
            (addTask)="openCreateTaskDialog($event)" (bulkAddTask)="openBulkCreateTaskDialog($event)"
            (editTask)="openEditTaskDialog($event)" (copyTask)="openCopyTaskDialog($event)"
            (deleteTask)="openDeleteTaskDialog($event)">
          </app-project-view-tab>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>