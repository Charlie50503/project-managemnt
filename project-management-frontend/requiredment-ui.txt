import React, { useState } from 'react';
import { Search, Download, AlertTriangle, CheckCircle, Clock, User, Folder, ChevronDown, ChevronRight } from 'lucide-react';

const ProjectDashboard = () => {
  const [activeTab, setActiveTab] = useState('overview');
  const [searchTerm, setSearchTerm] = useState('');
  const [statusFilter, setStatusFilter] = useState('all');
  const [expandedRows, setExpandedRows] = useState(new Set());

  // æ¨¡æ“¬è³‡æ–™
  const memberTableData = [
    {
      id: 1,
      member: 'ç‹å·¥ç¨‹å¸«',
      project: 'Aç³»çµ±',
      system: 'æœƒå“¡ç®¡ç†ç³»çµ±',
      task: 'ç™»å…¥æ¨¡çµ„',
      complexity: 'ä¸­',
      priority: 'é«˜',
      progress: 100,
      status: 'completed',
      startDate: '2024-08-15',
      endDate: '2024-08-30',
      actualEndDate: '2024-08-28',
      workload: 80,
      demo: 'https://demo-a.example.com/login',
      screenshots: ['login_page.png', 'validation.png']
    },
    {
      id: 2,
      member: 'ç‹å·¥ç¨‹å¸«',
      project: 'Aç³»çµ±',
      system: 'æœƒå“¡ç®¡ç†ç³»çµ±',
      task: 'æ¬Šé™æ¨¡çµ„',
      complexity: 'é«˜',
      priority: 'é«˜',
      progress: 30,
      status: 'in-progress',
      startDate: '2024-08-29',
      endDate: '2024-09-15',
      actualEndDate: null,
      workload: 80,
      demo: null,
      screenshots: []
    },
    {
      id: 3,
      member: 'æå·¥ç¨‹å¸«',
      project: 'Bæ¡ˆä»¶',
      system: 'APIæœå‹™å¹³å°',
      task: 'APIé–‹ç™¼',
      complexity: 'é«˜',
      priority: 'ä¸­',
      progress: 70,
      status: 'in-progress',
      startDate: '2024-08-10',
      endDate: '2024-09-05',
      actualEndDate: null,
      workload: 85,
      demo: 'https://api-b.example.com/docs',
      screenshots: ['api_docs.png', 'postman_test.png']
    },
    {
      id: 4,
      member: 'æå·¥ç¨‹å¸«',
      project: 'Cç³»çµ±',
      system: 'å ±è¡¨å¹³å°',
      task: 'è³‡æ–™åº«è¨­è¨ˆ',
      complexity: 'ä¸­',
      priority: 'ä¸­',
      progress: 100,
      status: 'completed',
      startDate: '2024-08-20',
      endDate: '2024-09-01',
      actualEndDate: '2024-08-31',
      workload: 85,
      demo: null,
      screenshots: ['db_schema.png', 'erd_diagram.png']
    },
    {
      id: 5,
      member: 'é™³å·¥ç¨‹å¸«',
      project: 'Då°ˆæ¡ˆ',
      system: 'è¡Œå‹•æ‡‰ç”¨ç¨‹å¼',
      task: 'éœ€æ±‚åˆ†æ',
      complexity: 'ä¸­',
      priority: 'ä½',
      progress: 90,
      status: 'in-progress',
      startDate: '2024-08-01',
      endDate: '2024-09-03',
      actualEndDate: null,
      workload: 75,
      demo: null,
      screenshots: ['wireframe.png', 'user_story.png']
    },
    {
      id: 6,
      member: 'é™³å·¥ç¨‹å¸«',
      project: 'Eç³»çµ±',
      system: 'åº«å­˜ç®¡ç†',
      task: 'æ¶æ§‹è¨­è¨ˆ',
      complexity: 'é«˜',
      priority: 'é«˜',
      progress: 45,
      status: 'delayed',
      startDate: '2024-08-15',
      endDate: '2024-09-01',
      actualEndDate: null,
      workload: 75,
      demo: null,
      screenshots: []
    }
  ];

  const projectTableData = [
    {
      id: 1,
      project: 'Aç³»çµ±',
      system: 'æœƒå“¡ç®¡ç†ç³»çµ±',
      totalTasks: 5,
      completedTasks: 1,
      inProgressTasks: 1,
      delayedTasks: 0,
      overallProgress: 45,
      status: 'normal',
      projectManager: 'ç‹å·¥ç¨‹å¸«',
      startDate: '2024-08-15',
      expectedEndDate: '2024-10-30',
      currentMilestone: 'ç™»å…¥æ¨¡çµ„å®Œæˆ',
      nextMilestone: 'æ¬Šé™æ¨¡çµ„é–‹ç™¼',
      demo: 'https://demo-a.example.com',
      risks: []
    },
    {
      id: 2,
      project: 'Bæ¡ˆä»¶',
      system: 'APIæœå‹™å¹³å°',
      totalTasks: 3,
      completedTasks: 0,
      inProgressTasks: 1,
      delayedTasks: 0,
      overallProgress: 30,
      status: 'delayed',
      projectManager: 'æå·¥ç¨‹å¸«',
      startDate: '2024-08-10',
      expectedEndDate: '2024-09-30',
      currentMilestone: 'APIé–‹ç™¼é€²è¡Œä¸­(70%)',
      nextMilestone: 'APIæ¸¬è©¦èˆ‡æ–‡ä»¶',
      demo: 'https://api-b.example.com/docs',
      risks: ['ç¬¬ä¸‰æ–¹APIæ•´åˆå»¶é²']
    },
    {
      id: 3,
      project: 'Cç³»çµ±',
      system: 'å ±è¡¨å¹³å°',
      totalTasks: 4,
      completedTasks: 1,
      inProgressTasks: 0,
      delayedTasks: 0,
      overallProgress: 25,
      status: 'normal',
      projectManager: 'æå·¥ç¨‹å¸«',
      startDate: '2024-08-20',
      expectedEndDate: '2024-11-15',
      currentMilestone: 'è³‡æ–™åº«è¨­è¨ˆå®Œæˆ',
      nextMilestone: 'å‰ç«¯æ¡†æ¶å»ºç½®',
      demo: null,
      risks: []
    },
    {
      id: 4,
      project: 'Då°ˆæ¡ˆ',
      system: 'è¡Œå‹•æ‡‰ç”¨ç¨‹å¼',
      totalTasks: 6,
      completedTasks: 0,
      inProgressTasks: 1,
      delayedTasks: 0,
      overallProgress: 15,
      status: 'normal',
      projectManager: 'é™³å·¥ç¨‹å¸«',
      startDate: '2024-08-01',
      expectedEndDate: '2024-12-31',
      currentMilestone: 'éœ€æ±‚åˆ†ææ¥è¿‘å®Œæˆ(90%)',
      nextMilestone: 'ç³»çµ±æ¶æ§‹è¨­è¨ˆ',
      demo: null,
      risks: []
    },
    {
      id: 5,
      project: 'Eç³»çµ±',
      system: 'åº«å­˜ç®¡ç†',
      totalTasks: 5,
      completedTasks: 0,
      inProgressTasks: 0,
      delayedTasks: 1,
      overallProgress: 10,
      status: 'risk',
      projectManager: 'é™³å·¥ç¨‹å¸«',
      startDate: '2024-08-15',
      expectedEndDate: '2024-11-30',
      currentMilestone: 'æ¶æ§‹è¨­è¨ˆå»¶é²',
      nextMilestone: 'é‡æ–°è©•ä¼°éœ€æ±‚ç¯„åœ',
      demo: null,
      risks: ['éœ€æ±‚è®Šæ›´é »ç¹', 'æŠ€è¡“é¸å‹æœªå®šæ¡ˆ']
    }
  ];

  const toggleRow = (key) => {
    const newExpandedRows = new Set(expandedRows);
    if (newExpandedRows.has(key)) {
      newExpandedRows.delete(key);
    } else {
      newExpandedRows.add(key);
    }
    setExpandedRows(newExpandedRows);
  };

  const getStatusColor = (status) => {
    switch (status) {
      case 'completed': return 'bg-green-100 text-green-800';
      case 'in-progress': return 'bg-blue-100 text-blue-800';
      case 'delayed': return 'bg-red-100 text-red-800';
      case 'normal': return 'bg-green-100 text-green-800';
      case 'risk': return 'bg-red-100 text-red-800';
      default: return 'bg-gray-100 text-gray-800';
    }
  };

  const getStatusText = (status) => {
    switch (status) {
      case 'completed': return 'å·²å®Œæˆ';
      case 'in-progress': return 'é€²è¡Œä¸­';
      case 'delayed': return 'å»¶é²';
      case 'normal': return 'æ­£å¸¸';
      case 'risk': return 'é¢¨éšª';
      default: return 'æœªçŸ¥';
    }
  };

  const getPriorityColor = (priority) => {
    switch (priority) {
      case 'é«˜': return 'bg-red-100 text-red-800';
      case 'ä¸­': return 'bg-yellow-100 text-yellow-800';
      case 'ä½': return 'bg-green-100 text-green-800';
      default: return 'bg-gray-100 text-gray-800';
    }
  };

  const getComplexityColor = (complexity) => {
    switch (complexity) {
      case 'é«˜': return 'bg-purple-100 text-purple-800';
      case 'ä¸­': return 'bg-blue-100 text-blue-800';
      case 'ä½': return 'bg-gray-100 text-gray-800';
      default: return 'bg-gray-100 text-gray-800';
    }
  };

  // å°‡äººå“¡è³‡æ–™æŒ‰ç…§æˆå“¡+å°ˆæ¡ˆåˆ†çµ„
  const getGroupedMemberData = () => {
    const grouped = {};
    
    memberTableData.forEach(item => {
      const key = `${item.member}-${item.project}`;
      if (!grouped[key]) {
        grouped[key] = {
          member: item.member,
          project: item.project,
          system: item.system,
          workload: item.workload,
          tasks: [],
          overallProgress: 0,
          overallStatus: 'normal'
        };
      }
      grouped[key].tasks.push(item);
    });

    // è¨ˆç®—æ¯å€‹æˆå“¡+å°ˆæ¡ˆçš„æ•´é«”é€²åº¦å’Œç‹€æ…‹
    Object.keys(grouped).forEach(key => {
      const group = grouped[key];
      const totalProgress = group.tasks.reduce((sum, task) => sum + task.progress, 0);
      group.overallProgress = Math.round(totalProgress / group.tasks.length);
      
      // åˆ¤æ–·æ•´é«”ç‹€æ…‹
      if (group.tasks.some(task => task.status === 'delayed')) {
        group.overallStatus = 'delayed';
      } else if (group.tasks.some(task => task.status === 'in-progress')) {
        group.overallStatus = 'in-progress';
      } else {
        group.overallStatus = 'completed';
      }
      
      // è¨ˆç®—demoå’Œæˆªåœ–
      group.demos = group.tasks.filter(task => task.demo).map(task => task.demo);
      group.screenshots = group.tasks.reduce((acc, task) => acc + task.screenshots.length, 0);
    });

    return Object.values(grouped);
  };

  // å°‡å°ˆæ¡ˆè³‡æ–™æŒ‰ç…§å°ˆæ¡ˆåˆ†çµ„ï¼ŒåŒ…å«æ‰€æœ‰åƒèˆ‡çš„æˆå“¡å’Œä»»å‹™
  const getGroupedProjectData = () => {
    const grouped = {};
    
    // å¾ memberTableData ä¸­æå–æ¯å€‹å°ˆæ¡ˆçš„è©³ç´°ä»»å‹™è³‡è¨Š
    memberTableData.forEach(item => {
      if (!grouped[item.project]) {
        // å¾ projectTableData ä¸­æ‰¾åˆ°å°æ‡‰çš„å°ˆæ¡ˆåŸºæœ¬è³‡è¨Š
        const projectInfo = projectTableData.find(p => p.project === item.project) || {
          system: item.system,
          status: 'normal',
          startDate: item.startDate,
          expectedEndDate: item.endDate,
          currentMilestone: 'é€²è¡Œä¸­',
          nextMilestone: 'å¾…å®š',
          demo: null,
          risks: []
        };
        
        grouped[item.project] = {
          project: item.project,
          system: item.system,
          status: projectInfo.status,
          startDate: projectInfo.startDate,
          expectedEndDate: projectInfo.expectedEndDate,
          currentMilestone: projectInfo.currentMilestone,
          nextMilestone: projectInfo.nextMilestone,
          demo: projectInfo.demo,
          risks: projectInfo.risks,
          members: {},
          totalTasks: 0,
          completedTasks: 0,
          inProgressTasks: 0,
          delayedTasks: 0,
          overallProgress: 0
        };
      }
      
      // æŒ‰æˆå“¡åˆ†çµ„ä»»å‹™
      if (!grouped[item.project].members[item.member]) {
        grouped[item.project].members[item.member] = {
          member: item.member,
          workload: item.workload,
          tasks: []
        };
      }
      
      grouped[item.project].members[item.member].tasks.push(item);
      grouped[item.project].totalTasks++;
      
      // çµ±è¨ˆä»»å‹™ç‹€æ…‹
      if (item.status === 'completed') grouped[item.project].completedTasks++;
      else if (item.status === 'in-progress') grouped[item.project].inProgressTasks++;
      else if (item.status === 'delayed') grouped[item.project].delayedTasks++;
    });

    // è¨ˆç®—æ¯å€‹å°ˆæ¡ˆçš„æ•´é«”é€²åº¦
    Object.keys(grouped).forEach(projectKey => {
      const project = grouped[projectKey];
      if (project.totalTasks > 0) {
        const totalProgress = Object.values(project.members)
          .flatMap(member => member.tasks)
          .reduce((sum, task) => sum + task.progress, 0);
        project.overallProgress = Math.round(totalProgress / project.totalTasks);
      }
      
      // å°‡æˆå“¡ç‰©ä»¶è½‰ç‚ºé™£åˆ—ä»¥ä¾¿æ¸²æŸ“
      project.membersList = Object.values(project.members);
    });

    return Object.values(grouped);
  };

  // å–å¾—ç¯©é¸å¾Œçš„è³‡æ–™
  const groupedMemberData = getGroupedMemberData();
  const groupedProjectData = getGroupedProjectData();

  const filteredGroupedData = groupedMemberData.filter(group => {
    const matchesSearch = group.member.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         group.project.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         group.system.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         group.tasks.some(task => task.task.toLowerCase().includes(searchTerm.toLowerCase()));
    const matchesStatus = statusFilter === 'all' || group.overallStatus === statusFilter ||
                         group.tasks.some(task => task.status === statusFilter);
    return matchesSearch && matchesStatus;
  });

  const filteredProjectData = groupedProjectData.filter(project => {
    const matchesSearch = project.project.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         project.system.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         project.membersList.some(member => 
                           member.member.toLowerCase().includes(searchTerm.toLowerCase()) ||
                           member.tasks.some(task => task.task.toLowerCase().includes(searchTerm.toLowerCase()))
                         );
    const matchesStatus = statusFilter === 'all' || project.status === statusFilter ||
                         project.membersList.some(member => 
                           member.tasks.some(task => task.status === statusFilter)
                         );
    return matchesSearch && matchesStatus;
  });

  return (
    <div className="min-h-screen bg-gray-50 p-6">
      <div className="max-w-7xl mx-auto">
        {/* æ¨™é¡Œèˆ‡æ“ä½œå€ */}
        <div className="mb-6">
          <div className="flex justify-between items-center mb-4">
            <div>
              <h1 className="text-3xl font-bold text-gray-900 mb-2">å°ˆæ¡ˆé€²åº¦ç®¡ç†ç³»çµ±</h1>
              <p className="text-gray-600">é›™é€±é€²åº¦å ±å‘Š - {new Date().toLocaleDateString('zh-TW')}</p>
            </div>
            <div className="flex gap-2">
              <button className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                <Download className="w-4 h-4" />
                åŒ¯å‡º Excel
              </button>
            </div>
          </div>

          {/* æœå°‹èˆ‡ç¯©é¸ */}
          <div className="flex gap-4 mb-4">
            <div className="flex-1 relative">
              <Search className="w-4 h-4 absolute left-3 top-3 text-gray-400" />
              <input
                type="text"
                placeholder="æœå°‹æˆå“¡ã€å°ˆæ¡ˆæˆ–ä»»å‹™..."
                className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
              />
            </div>
            <select 
              className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              value={statusFilter}
              onChange={(e) => setStatusFilter(e.target.value)}
            >
              <option value="all">æ‰€æœ‰ç‹€æ…‹</option>
              <option value="completed">å·²å®Œæˆ</option>
              <option value="in-progress">é€²è¡Œä¸­</option>
              <option value="delayed">å»¶é²</option>
              <option value="normal">æ­£å¸¸</option>
              <option value="risk">é¢¨éšª</option>
            </select>
          </div>
        </div>

        {/* å°èˆªæ¨™ç±¤ */}
        <div className="mb-6 border-b border-gray-200">
          <nav className="-mb-px flex space-x-8">
            {[
              { key: 'overview', label: 'ç¸½è¦½æ‘˜è¦', icon: AlertTriangle },
              { key: 'members', label: 'äººå“¡è¦–è§’è¡¨æ ¼', icon: User },
              { key: 'projects', label: 'å°ˆæ¡ˆè¦–è§’è¡¨æ ¼', icon: Folder }
            ].map(({ key, label, icon: Icon }) => (
              <button
                key={key}
                onClick={() => setActiveTab(key)}
                className={`py-2 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${
                  activeTab === key
                    ? 'border-blue-500 text-blue-600'
                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                }`}
              >
                <Icon className="w-4 h-4" />
                {label}
              </button>
            ))}
          </nav>
        </div>

        {/* ç¸½è¦½æ‘˜è¦ */}
        {activeTab === 'overview' && (
          <div className="space-y-6">
            {/* å¿«é€Ÿçµ±è¨ˆ */}
            <div className="grid grid-cols-1 md:grid-cols-5 gap-4">
              <div className="bg-white rounded-lg shadow p-4 text-center">
                <div className="text-2xl font-bold text-blue-600">5</div>
                <div className="text-sm text-gray-600">é€²è¡Œä¸­å°ˆæ¡ˆ</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4 text-center">
                <div className="text-2xl font-bold text-green-600">2</div>
                <div className="text-sm text-gray-600">å·²å®Œæˆä»»å‹™</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4 text-center">
                <div className="text-2xl font-bold text-yellow-600">4</div>
                <div className="text-sm text-gray-600">é€²è¡Œä¸­ä»»å‹™</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4 text-center">
                <div className="text-2xl font-bold text-red-600">1</div>
                <div className="text-sm text-gray-600">å»¶é²ä»»å‹™</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4 text-center">
                <div className="text-2xl font-bold text-purple-600">80%</div>
                <div className="text-sm text-gray-600">å¹³å‡å·¥ä½œè² è·</div>
              </div>
            </div>

            {/* é¢¨éšªè­¦ç¤º */}
            <div className="bg-white rounded-lg shadow p-6">
              <h3 className="text-lg font-semibold mb-4 text-red-600 flex items-center gap-2">
                <AlertTriangle className="w-5 h-5" />
                éœ€è¦æ³¨æ„çš„é …ç›®
              </h3>
              <div className="space-y-3">
                <div className="flex items-center justify-between p-3 bg-red-50 rounded-lg">
                  <div>
                    <span className="font-medium">Eç³»çµ± - æ¶æ§‹è¨­è¨ˆ</span>
                    <span className="text-sm text-gray-600 ml-2">(é™³å·¥ç¨‹å¸«)</span>
                  </div>
                  <span className="text-red-600 text-sm">é€²åº¦å»¶é²ï¼Œéœ€é‡æ–°è©•ä¼°</span>
                </div>
                <div className="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                  <div>
                    <span className="font-medium">Bæ¡ˆä»¶ - APIé–‹ç™¼</span>
                    <span className="text-sm text-gray-600 ml-2">(æå·¥ç¨‹å¸«)</span>
                  </div>
                  <span className="text-yellow-600 text-sm">ç¬¬ä¸‰æ–¹APIæ•´åˆå¯èƒ½å»¶é²</span>
                </div>
              </div>
            </div>

            {/* æœ¬æœŸæˆæœèˆ‡ä¸‹æœŸç›®æ¨™ */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div className="bg-white rounded-lg shadow p-6">
                <h3 className="text-lg font-semibold mb-4 text-green-600">æœ¬æœŸå®Œæˆæˆæœ</h3>
                <div className="space-y-3">
                  <div className="flex items-center gap-3">
                    <CheckCircle className="w-5 h-5 text-green-600" />
                    <div>
                      <div className="font-medium">Aç³»çµ± - ç™»å…¥æ¨¡çµ„</div>
                      <div className="text-sm text-gray-600">æå‰2å¤©å®Œæˆï¼ŒåŒ…å«é©—è­‰åŠŸèƒ½</div>
                    </div>
                  </div>
                  <div className="flex items-center gap-3">
                    <CheckCircle className="w-5 h-5 text-green-600" />
                    <div>
                      <div className="font-medium">Cç³»çµ± - è³‡æ–™åº«è¨­è¨ˆ</div>
                      <div className="text-sm text-gray-600">å¦‚æœŸå®Œæˆï¼ŒERDåœ–å·²ç¢ºèª</div>
                    </div>
                  </div>
                </div>
              </div>

              <div className="bg-white rounded-lg shadow p-6">
                <h3 className="text-lg font-semibold mb-4 text-blue-600">ä¸‹æœŸé‡é»ç›®æ¨™</h3>
                <div className="space-y-3">
                  <div className="flex items-center gap-3">
                    <Clock className="w-5 h-5 text-blue-600" />
                    <div>
                      <div className="font-medium">Aç³»çµ± - æ¬Šé™æ¨¡çµ„é–‹ç™¼</div>
                      <div className="text-sm text-gray-600">é è¨ˆ9æœˆ15æ—¥å®Œæˆ</div>
                    </div>
                  </div>
                  <div className="flex items-center gap-3">
                    <Clock className="w-5 h-5 text-blue-600" />
                    <div>
                      <div className="font-medium">Bæ¡ˆä»¶ - APIæ¸¬è©¦</div>
                      <div className="text-sm text-gray-600">APIé–‹ç™¼å®Œæˆå¾Œç«‹å³å•Ÿå‹•</div>
                    </div>
                  </div>
                  <div className="flex items-center gap-3">
                    <Clock className="w-5 h-5 text-blue-600" />
                    <div>
                      <div className="font-medium">Cç³»çµ± - å‰ç«¯é–‹ç™¼</div>
                      <div className="text-sm text-gray-600">æ¡†æ¶å»ºç½®èˆ‡é¦–é é–‹ç™¼</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* äººå“¡è¦–è§’è¡¨æ ¼ */}
        {activeTab === 'members' && (
          <div className="bg-white rounded-lg shadow overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8"></th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æˆå“¡</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å°ˆæ¡ˆ/ç³»çµ±</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ä»»å‹™çµ±è¨ˆ</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ•´é«”é€²åº¦</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç‹€æ…‹</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æˆæœ</th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {filteredGroupedData.map((group) => {
                    const rowKey = `${group.member}-${group.project}`;
                    const isExpanded = expandedRows.has(rowKey);
                    
                    return (
                      <React.Fragment key={rowKey}>
                        {/* ä¸»è¦è¡Œ - æˆå“¡+å°ˆæ¡ˆæ¦‚è¦½ */}
                        <tr className="hover:bg-gray-50 cursor-pointer" onClick={() => toggleRow(rowKey)}>
                          <td className="px-4 py-4 whitespace-nowrap">
                            {isExpanded ? 
                              <ChevronDown className="w-4 h-4 text-gray-400" /> : 
                              <ChevronRight className="w-4 h-4 text-gray-400" />
                            }
                          </td>
                          <td className="px-4 py-4 whitespace-nowrap">
                            <div className="font-medium text-gray-900">{group.member}</div>
                            <div className="text-sm text-gray-500">è² è·: {group.workload}%</div>
                          </td>
                          <td className="px-4 py-4">
                            <div className="font-medium text-gray-900">{group.project}</div>
                            <div className="text-sm text-gray-500">{group.system}</div>
                          </td>
                          <td className="px-4 py-4 text-sm">
                            <div>ç¸½ä»»å‹™: {group.tasks.length} é …</div>
                            <div className="text-green-600">
                              å®Œæˆ: {group.tasks.filter(t => t.status === 'completed').length}
                            </div>
                            <div className="text-blue-600">
                              é€²è¡Œ: {group.tasks.filter(t => t.status === 'in-progress').length}
                            </div>
                            {group.tasks.filter(t => t.status === 'delayed').length > 0 && (
                              <div className="text-red-600">
                                å»¶é²: {group.tasks.filter(t => t.status === 'delayed').length}
                              </div>
                            )}
                          </td>
                          <td className="px-4 py-4">
                            <div className="flex items-center">
                              <div className="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                <div 
                                  className={`h-2 rounded-full ${group.overallProgress === 100 ? 'bg-green-500' : group.overallStatus === 'delayed' ? 'bg-red-500' : 'bg-blue-500'}`}
                                  style={{ width: `${group.overallProgress}%` }}
                                ></div>
                              </div>
                              <span className="text-sm text-gray-600">{group.overallProgress}%</span>
                            </div>
                          </td>
                          <td className="px-4 py-4">
                            <span className={`px-2 py-1 rounded-full text-xs ${getStatusColor(group.overallStatus)}`}>
                              {getStatusText(group.overallStatus)}
                            </span>
                          </td>
                          <td className="px-4 py-4">
                            <div className="space-y-1">
                              {group.demos.length > 0 && (
                                <div className="text-xs text-blue-600">
                                  ğŸ”— {group.demos.length} å€‹Demo
                                </div>
                              )}
                              {group.screenshots > 0 && (
                                <div className="text-xs text-gray-600">
                                  ğŸ“¸ {group.screenshots} å€‹æˆªåœ–
                                </div>
                              )}
                              {group.demos.length === 0 && group.screenshots === 0 && (
                                <span className="text-xs text-gray-400">ç„¡</span>
                              )}
                            </div>
                          </td>
                        </tr>
                        
                        {/* å±•é–‹çš„è©³ç´°ä»»å‹™è¡Œ */}
                        {isExpanded && group.tasks.map((task) => (
                          <tr key={task.id} className="bg-blue-25 border-l-4 border-blue-200">
                            <td className="px-4 py-3"></td>
                            <td className="px-4 py-3 text-sm text-gray-600 pl-8">
                              â”” ä»»å‹™ç´°é …
                            </td>
                            <td className="px-4 py-3">
                              <div className="font-medium text-gray-800 text-sm">{task.task}</div>
                            </td>
                            <td className="px-4 py-3">
                              <div className="flex gap-2">
                                <span className={`px-2 py-1 rounded-full text-xs ${getComplexityColor(task.complexity)}`}>
                                  è¤‡é›œåº¦: {task.complexity}
                                </span>
                                <span className={`px-2 py-1 rounded-full text-xs ${getPriorityColor(task.priority)}`}>
                                  å„ªå…ˆ: {task.priority}
                                </span>
                              </div>
                            </td>
                            <td className="px-4 py-3">
                              <div className="flex items-center">
                                <div className="w-12 bg-gray-200 rounded-full h-1.5 mr-2">
                                  <div 
                                    className={`h-1.5 rounded-full ${task.progress === 100 ? 'bg-green-500' : task.status === 'delayed' ? 'bg-red-500' : 'bg-blue-500'}`}
                                    style={{ width: `${task.progress}%` }}
                                  ></div>
                                </div>
                                <span className="text-xs text-gray-600">{task.progress}%</span>
                              </div>
                            </td>
                            <td className="px-4 py-3">
                              <span className={`px-2 py-1 rounded-full text-xs ${getStatusColor(task.status)}`}>
                                {getStatusText(task.status)}
                              </span>
                            </td>
                            <td className="px-4 py-3">
                              <div className="space-y-1 text-xs">
                                <div>é–‹å§‹: {task.startDate}</div>
                                <div>é è¨ˆ: {task.endDate}</div>
                                {task.actualEndDate && <div className="text-green-600">å®Œæˆ: {task.actualEndDate}</div>}
                                {task.demo && (
                                  <a href={task.demo} className="text-blue-600 hover:underline block" target="_blank" rel="noopener noreferrer">
                                    ğŸ”— Demo
                                  </a>
                                )}
                                {task.screenshots.length > 0 && (
                                  <div className="text-gray-600">
                                    ğŸ“¸ {task.screenshots.join(', ')}
                                  </div>
                                )}
                              </div>
                            </td>
                          </tr>
                        ))}
                      </React.Fragment>
                    );
                  })}
                </tbody>
              </table>
            </div>
          </div>
        )}

        {/* å°ˆæ¡ˆè¦–è§’è¡¨æ ¼ */}
        {activeTab === 'projects' && (
          <div className="bg-white rounded-lg shadow overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8"></th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å°ˆæ¡ˆ/ç³»çµ±</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ä»»å‹™çµ±è¨ˆ</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ•´é«”é€²åº¦</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç‹€æ…‹</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é‡Œç¨‹ç¢‘</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ™‚ç¨‹</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æˆæœ/é¢¨éšª</th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {filteredProjectData.map((project) => {
                    const rowKey = `project-${project.project}`;
                    const isExpanded = expandedRows.has(rowKey);
                    
                    return (
                      <React.Fragment key={rowKey}>
                        {/* ä¸»è¦è¡Œ - å°ˆæ¡ˆæ¦‚è¦½ */}
                        <tr className="hover:bg-gray-50 cursor-pointer" onClick={() => toggleRow(rowKey)}>
                          <td className="px-4 py-4 whitespace-nowrap">
                            {isExpanded ? 
                              <ChevronDown className="w-4 h-4 text-gray-400" /> : 
                              <ChevronRight className="w-4 h-4 text-gray-400" />
                            }
                          </td>
                          <td className="px-4 py-4">
                            <div className="font-medium text-gray-900">{project.project}</div>
                            <div className="text-sm text-gray-500">{project.system}</div>
                            <div className="text-xs text-gray-400 mt-1">
                              åƒèˆ‡äººå“¡: {project.membersList.map(m => m.member).join(', ')}
                            </div>
                          </td>
                          <td className="px-4 py-4 text-sm">
                            <div>ç¸½è¨ˆ: {project.totalTasks} é …</div>
                            <div className="text-green-600">å®Œæˆ: {project.completedTasks}</div>
                            <div className="text-blue-600">é€²è¡Œ: {project.inProgressTasks}</div>
                            {project.delayedTasks > 0 && <div className="text-red-600">å»¶é²: {project.delayedTasks}</div>}
                          </td>
                          <td className="px-4 py-4">
                            <div className="flex items-center">
                              <div className="w-20 bg-gray-200 rounded-full h-3 mr-2">
                                <div 
                                  className={`h-3 rounded-full ${project.overallProgress > 70 ? 'bg-green-500' : project.overallProgress > 40 ? 'bg-yellow-500' : 'bg-red-500'}`}
                                  style={{ width: `${project.overallProgress}%` }}
                                ></div>
                              </div>
                              <span className="text-sm font-medium">{project.overallProgress}%</span>
                            </div>
                          </td>
                          <td className="px-4 py-4">
                            <span className={`px-2 py-1 rounded-full text-xs ${getStatusColor(project.status)}`}>
                              {getStatusText(project.status)}
                            </span>
                          </td>
                          <td className="px-4 py-4 text-sm">
                            <div className="mb-2">
                              <div className="font-medium text-green-600">ç›®å‰:</div>
                              <div>{project.currentMilestone}</div>
                            </div>
                            <div>
                              <div className="font-medium text-blue-600">ä¸‹éšæ®µ:</div>
                              <div>{project.nextMilestone}</div>
                            </div>
                          </td>
                          <td className="px-4 py-4 text-sm">
                            <div>é–‹å§‹: {project.startDate}</div>
                            <div>é è¨ˆå®Œæˆ: {project.expectedEndDate}</div>
                          </td>
                          <td className="px-4 py-4 text-sm">
                            <div className="space-y-2">
                              {project.demo && (
                                <a href={project.demo} className="text-blue-600 hover:underline block" target="_blank" rel="noopener noreferrer">
                                  ğŸ”— å°ˆæ¡ˆDemo
                                </a>
                              )}
                              {project.risks.length > 0 && (
                                <div>
                                  <div className="font-medium text-red-600 flex items-center gap-1">
                                    <AlertTriangle className="w-3 h-3" />
                                    é¢¨éšª:
                                  </div>
                                  {project.risks.map((risk, index) => (
                                    <div key={index} className="text-red-600 text-xs">â€¢ {risk}</div>
                                  ))}
                                </div>
                              )}
                              {!project.demo && project.risks.length === 0 && (
                                <span className="text-gray-400">æš«ç„¡ç‰¹æ®Šäº‹é …</span>
                              )}
                            </div>
                          </td>
                        </tr>
                        
                        {/* å±•é–‹çš„æˆå“¡åŠä»»å‹™è©³ç´°è¡Œ */}
                        {isExpanded && project.membersList.map((member) => (
                          <React.Fragment key={`${project.project}-${member.member}`}>
                            {/* æˆå“¡æ¨™é¡Œè¡Œ */}
                            <tr className="bg-green-25 border-l-4 border-green-200">
                              <td className="px-4 py-3"></td>
                              <td className="px-4 py-3 text-sm font-medium text-gray-700 pl-8">
                                ğŸ‘¤ {member.member}
                                <span className="text-xs text-gray-500 ml-2">(è² è·: {member.workload}%)</span>
                              </td>
                              <td className="px-4 py-3 text-sm text-gray-600">
                                {member.tasks.length} å€‹ä»»å‹™
                              </td>
                              <td className="px-4 py-3">
                                <div className="flex items-center">
                                  <div className="w-12 bg-gray-200 rounded-full h-1.5 mr-2">
                                    <div 
                                      className={`h-1.5 rounded-full bg-blue-500`}
                                      style={{ width: `${Math.round(member.tasks.reduce((sum, task) => sum + task.progress, 0) / member.tasks.length)}%` }}
                                    ></div>
                                  </div>
                                  <span className="text-xs text-gray-600">
                                    {Math.round(member.tasks.reduce((sum, task) => sum + task.progress, 0) / member.tasks.length)}%
                                  </span>
                                </div>
                              </td>
                              <td className="px-4 py-3">
                                <span className={`px-2 py-1 rounded-full text-xs ${getStatusColor(
                                  member.tasks.some(t => t.status === 'delayed') ? 'delayed' :
                                  member.tasks.some(t => t.status === 'in-progress') ? 'in-progress' : 'completed'
                                )}`}>
                                  {member.tasks.some(t => t.status === 'delayed') ? 'æœ‰å»¶é²' :
                                   member.tasks.some(t => t.status === 'in-progress') ? 'é€²è¡Œä¸­' : 'å·²å®Œæˆ'}
                                </span>
                              </td>
                              <td className="px-4 py-3"></td>
                              <td className="px-4 py-3"></td>
                              <td className="px-4 py-3"></td>
                            </tr>
                            
                            {/* è©²æˆå“¡çš„ä»»å‹™è©³ç´°è¡Œ */}
                            {member.tasks.map((task) => (
                              <tr key={task.id} className="bg-blue-25 border-l-4 border-blue-100">
                                <td className="px-4 py-2"></td>
                                <td className="px-4 py-2 text-sm text-gray-600 pl-12">
                                  â”” {task.task}
                                </td>
                                <td className="px-4 py-2">
                                  <div className="flex gap-1">
                                    <span className={`px-1.5 py-0.5 rounded text-xs ${getComplexityColor(task.complexity)}`}>
                                      {task.complexity}
                                    </span>
                                    <span className={`px-1.5 py-0.5 rounded text-xs ${getPriorityColor(task.priority)}`}>
                                      {task.priority}
                                    </span>
                                  </div>
                                </td>
                                <td className="px-4 py-2">
                                  <div className="flex items-center">
                                    <div className="w-10 bg-gray-200 rounded-full h-1 mr-1">
                                      <div 
                                        className={`h-1 rounded-full ${task.progress === 100 ? 'bg-green-500' : task.status === 'delayed' ? 'bg-red-500' : 'bg-blue-500'}`}
                                        style={{ width: `${task.progress}%` }}
                                      ></div>
                                    </div>
                                    <span className="text-xs text-gray-600">{task.progress}%</span>
                                  </div>
                                </td>
                                <td className="px-4 py-2">
                                  <span className={`px-1.5 py-0.5 rounded text-xs ${getStatusColor(task.status)}`}>
                                    {getStatusText(task.status)}
                                  </span>
                                </td>
                                <td className="px-4 py-2 text-xs text-gray-600">
                                  {task.startDate} ~ {task.endDate}
                                  {task.actualEndDate && <div className="text-green-600">å®Œæˆ: {task.actualEndDate}</div>}
                                </td>
                                <td className="px-4 py-2 text-xs text-gray-600">
                                  é è¨ˆ: {task.endDate}
                                </td>
                                <td className="px-4 py-2 text-xs">
                                  {task.demo && (
                                    <a href={task.demo} className="text-blue-600 hover:underline block" target="_blank" rel="noopener noreferrer">
                                      ğŸ”— Demo
                                    </a>
                                  )}
                                  {task.screenshots.length > 0 && (
                                    <div className="text-gray-600">ğŸ“¸ {task.screenshots.length}</div>
                                  )}
                                </td>
                              </tr>
                            ))}
                          </React.Fragment>
                        ))}
                      </React.Fragment>
                    );
                  })}
                </tbody>
              </table>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default ProjectDashboard;